<html>
 <head>
  <title>
   Python项目实战&mdash;&mdash;外汇牌价（附源码）
  </title>
  <link data-noprefix="" href="prism.css" rel="stylesheet">
  <style>
   a{
    color: black;
    text-decoration: none;
}
a:hover{
    color: blue;
}
ul{
    list-style: none;
}
#catalogue {
    top: 10px;
    right: 10px;
    z-index: 1;
    padding: 5px 10px;
    position: absolute;
    border: 1px solid blue;
    background-color: white;
}
  </style>
 </head>
 <body>
  <h1>
   <a>
    Python项目实战&mdash;&mdash;外汇牌价（附源码）
   </a>
  </h1>
  <ul id="catalogue">
   <li title="返回目录">
    <a href="/html">
     返回目录
    </a>
   </li>
   <li title="前言">
    <a href="#user-content-前言">
     前言
    </a>
   </li>
   <ul>
    <li title=" ">
     <a href="#user-content- ">
     </a>
    </li>
    <ul>
     <li title="环境使用">
      <a href="#user-content-环境使用">
       环境使用
      </a>
     </li>
     <li title="模块使用">
      <a href="#user-content-模块使用">
       模块使用
      </a>
     </li>
     <li title="模块介绍">
      <a href="#user-content-模块介绍">
       模块介绍
      </a>
     </li>
    </ul>
    <li title="代码实现">
     <a href="#user-content-代码实现">
      代码实现
     </a>
    </li>
    <li title="效果展示">
     <a href="#user-content-效果展示">
      效果展示
     </a>
    </li>
   </ul>
  </ul>
  <h1>
   <a aria-hidden="true" class="anchor" href="#前言" id="user-content-前言">
    <span aria-hidden="true" class="octicon octicon-link">
    </span>
   </a>
   前言
  </h1>
  <p>
   <img alt="1b83b1d3fff541e6844ba7bfc4b8f724.gif" src="https://img-blog.csdnimg.cn/1b83b1d3fff541e6844ba7bfc4b8f724.gif" style="max-width: 100%;">
  </p>
  <blockquote>
   <p>
    几乎每个人都在使用银行卡，今天我们就来爬取某行外汇牌价，获取我们想要的数据。
   </p>
  </blockquote>
  <h3>
   <a aria-hidden="true" class="anchor" href="#环境使用" id="user-content-环境使用">
    <span aria-hidden="true" class="octicon octicon-link">
    </span>
   </a>
   <strong>
    环境使用
   </strong>
  </h3>
  <ul>
   <li>
    python 3.9
   </li>
   <li>
    pycharm
   </li>
  </ul>
  <h3>
   <a aria-hidden="true" class="anchor" href="#模块使用" id="user-content-模块使用">
    <span aria-hidden="true" class="octicon octicon-link">
    </span>
   </a>
   <strong>
    模块使用
   </strong>
  </h3>
  <ul>
   <li>
    requests
   </li>
  </ul>
  <h3>
   <a aria-hidden="true" class="anchor" href="#模块介绍" id="user-content-模块介绍">
    <span aria-hidden="true" class="octicon octicon-link">
    </span>
   </a>
   <strong>
    模块介绍
   </strong>
  </h3>
  <blockquote>
   <ul>
    <li>
     <strong>
      requests
     </strong>
    </li>
   </ul>
   <p>
    requests是一个很实用的Python HTTP客户端库，爬虫和测试服务器响应数据时经常会用到，requests是Python语言的第三方的库，专门用于发送HTTP请求，使用起来比urllib简洁很多。
   </p>
   <ul>
    <li>
     <strong>
      parsel
     </strong>
    </li>
   </ul>
   <p>
    parsel是一个python的第三方库，相当于css选择器+xpath+re。
   </p>
   <p>
    parsel由scrapy团队开发，是将scrapy中的parsel独立抽取出来的，可以轻松解析html，xml内容，获取需要的数据。
   </p>
   <p>
    相比于BeautifulSoup，xpath，parsel效率更高，使用更简单。
   </p>
   <ul>
    <li>
     <strong>
      re
     </strong>
    </li>
   </ul>
   <p>
    re模块是python独有的匹配字符串的模块，该模块中提供的很多功能是基于正则表达式实现的，而正则表达式是对字符串进行模糊匹配，提取自己需要的字符串部分，他对所有的语言都通用。
   </p>
   <ul>
    <li>
     <strong>
      os
     </strong>
    </li>
   </ul>
   <p>
    os 就是 &ldquo;operating system&rdquo; 的缩写，顾名思义，
    <a href="https://so.csdn.net/so/search?q=os%E6%A8%A1%E5%9D%97&amp;spm=1001.2101.3001.7020" rel="nofollow" title="os模块">
     os模块
    </a>
    提供的就是各种 Python 程序与操作系统进行交互的接口。通过使用 os 模块，一方面可以方便地与操作系统进行交互，另一方面也可以极大增强代码的可移植性。
   </p>
   <ul>
    <li>
     <strong>
      csv
     </strong>
    </li>
   </ul>
   <p>
    它是一种文件格式，一般也被叫做逗号分隔值文件，可以使用 Excel 软件或者文本文档打开 。其中数据字段用半角逗号间隔（也可以使用其它字符），使用 Excel 打开时，逗号会被转换为分隔符。csv 文件是以纯文本形式存储了表格数据，并且在兼容各个操作系统。
   </p>
  </blockquote>
  <p>
   <strong>
    模块安装问题:
   </strong>
  </p>
  <ul>
   <li>
    如果安装python第三方模块:
   </li>
  </ul>
  <blockquote>
   <p>
    win + R 输入 cmd 点击确定, 输入安装命令 pip install 模块名 (pip install requests) 回车
   </p>
   <p>
    在pycharm中点击Terminal(终端) 输入安装命令
   </p>
  </blockquote>
  <ul>
   <li>
    安装失败原因:
   </li>
  </ul>
  <blockquote>
   <ul>
    <li>
     失败一: pip 不是内部命令
    </li>
   </ul>
   <p>
    解决方法: 设置环境变量
   </p>
   <ul>
    <li>
     失败二: 出现大量报红 (read time out)
    </li>
   </ul>
   <p>
    解决方法: 因为是网络链接超时, 需要切换镜像源
   </p>
   <pre class="line-numbers"><code class="language-python">清华：https<span class="token punctuation">:</span><span class="token operator">//</span>pypi<span class="token punctuation">.</span>tuna<span class="token punctuation">.</span>tsinghua<span class="token punctuation">.</span>edu<span class="token punctuation">.</span>cn<span class="token operator">/</span>simple
    阿里云：https<span class="token punctuation">:</span><span class="token operator">//</span>mirrors<span class="token punctuation">.</span>aliyun<span class="token punctuation">.</span>com<span class="token operator">/</span>pypi<span class="token operator">/</span>simple<span class="token operator">/</span>
    中国科技大学 https<span class="token punctuation">:</span><span class="token operator">//</span>pypi<span class="token punctuation">.</span>mirrors<span class="token punctuation">.</span>ustc<span class="token punctuation">.</span>edu<span class="token punctuation">.</span>cn<span class="token operator">/</span>simple<span class="token operator">/</span>
    华中理工大学：https<span class="token punctuation">:</span><span class="token operator">//</span>pypi<span class="token punctuation">.</span>hustunique<span class="token punctuation">.</span>com<span class="token operator">/</span>
    山东理工大学：https<span class="token punctuation">:</span><span class="token operator">//</span>pypi<span class="token punctuation">.</span>sdutlinux<span class="token punctuation">.</span>org<span class="token operator">/</span>
    豆瓣：https<span class="token punctuation">:</span><span class="token operator">//</span>pypi<span class="token punctuation">.</span>douban<span class="token punctuation">.</span>com<span class="token operator">/</span>simple<span class="token operator">/</span>
    例如：pip3 install <span class="token operator">-</span>i https<span class="token punctuation">:</span><span class="token operator">//</span>pypi<span class="token punctuation">.</span>doubanio<span class="token punctuation">.</span>com<span class="token operator">/</span>simple<span class="token operator">/</span> 模块名</code></pre>
   <p>
    失败三: cmd里面显示已经安装过了, 或者安装成功了, 但是在pycharm里面还是无法导入
   </p>
   <p>
    解决方法: 可能安装了多个python版本 (anaconda 或者 python 安装一个即可) 卸载一个就好，或者你pycharm里面python解释器没有设置好。
   </p>
  </blockquote>
  <h2>
   <a aria-hidden="true" class="anchor" href="#代码实现" id="user-content-代码实现">
    <span aria-hidden="true" class="octicon octicon-link">
    </span>
   </a>
   代码实现
  </h2>
  <p>
   首先，我们不管爬取什么网站，我们第一步就是要做的是，确认数据来源。知道我们要请求的网站是什么。就本文来说，我们确定请求的网站如下：
  </p>
  <blockquote>
   <p>
    <a href="https://www.boc.cn/sourcedb/whpj/index.html" rel="nofollow">
     https://www.boc.cn/sourcedb/whpj/index.html
    </a>
   </p>
  </blockquote>
  <p>
   我们想把['货币名称', '现汇买入价', '现钞买入价', '现汇卖出价', '现钞卖出价', '中行折算价', '发布日期', '发布时间']的数据获取下来，有的人说我复制粘贴，这岂不是太麻烦，既然学了python，为什么不用python获取呢。
  </p>
  <p>
   接下来，我们开始分析数据，我们可以发现这是一个静态的网页。那么就更容易了，没有什么异步加载之类的。我们通过分析网页发现，我们可以使用xpath或者css定位数据。今天呢，主要用css的方法获取我们想要的数据。
  </p>
  <p>
   <img alt="240b455a5b0741e38e7845a6463b1bc1.png" src="https://img-blog.csdnimg.cn/240b455a5b0741e38e7845a6463b1bc1.png" style="max-width: 100%;">
  </p>
  <p>
   首先，我们和爬其他网页一样，都是先发送请求，然后获取响应。本文也不例外。
  </p>
  <pre class="line-numbers"><code class="language-python">res <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">,</span> headers<span class="token operator">=</span>headers<span class="token punctuation">)</span>
    res<span class="token punctuation">.</span>encoding <span class="token operator">=</span> res<span class="token punctuation">.</span>apparent_encoding
    <span class="token comment"># print(res.text)</span>

    selector <span class="token operator">=</span> parsel<span class="token punctuation">.</span>Selector<span class="token punctuation">(</span>res<span class="token punctuation">.</span>text<span class="token punctuation">)</span></code></pre>
  <p>
   我们会发现数据就在tr标签里面，接下来，我们的目标就是获取tr标签。
  </p>
  <p>
   我们发现数据的标题和数据不在一个标签下，所以，我们先获取标题。代码如下：
  </p>
  <pre class="line-numbers"><code class="language-python">titles <span class="token operator">=</span> selector<span class="token punctuation">.</span>css<span class="token punctuation">(</span><span class="token string">'div table tr th::text'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>getall<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
  <p>
   <img alt="dea8e87cb0df4a5497ff8df8325b9290.png" src="https://img-blog.csdnimg.cn/dea8e87cb0df4a5497ff8df8325b9290.png" style="max-width: 100%;">
  </p>
  <p>
   接下来，我们就可以获取我们的数据了，我们会发现，这是一个列表，所以我们要for循环遍历它。以获取货币名称为例，简单介绍一下，如何获取到我们想要的数据。
  </p>
  <p>
   <img alt="f749764297e443569fe03670a19db5f8.png" src="https://img-blog.csdnimg.cn/f749764297e443569fe03670a19db5f8.png" style="max-width: 100%;">
  </p>
  <p>
   我们可以直观的看到，它在第一个，那么我们的代码如何实现呢。
  </p>
  <pre class="line-numbers"><code class="language-python">theNameOfTheCurrency <span class="token operator">=</span> info_list<span class="token punctuation">.</span>css<span class="token punctuation">(</span><span class="token string">'td:nth-child(1)::text'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
  <p>
   <img alt="1af23f0b5f934aee9b792c33d2c75a41.png" src="https://img-blog.csdnimg.cn/1af23f0b5f934aee9b792c33d2c75a41.png" style="max-width: 100%;">
  </p>
  <p>
   后面的代码就不解释，直接上代码。
  </p>
  <pre class="line-numbers"><code class="language-python">spotPrice <span class="token operator">=</span> info_list<span class="token punctuation">.</span>css<span class="token punctuation">(</span><span class="token string">'td:nth-child(2)::text'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token punctuation">)</span>
        buyingRateForNotes <span class="token operator">=</span> info_list<span class="token punctuation">.</span>css<span class="token punctuation">(</span><span class="token string">'td:nth-child(3)::text'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token punctuation">)</span>
        theSpotSellingRate <span class="token operator">=</span> info_list<span class="token punctuation">.</span>css<span class="token punctuation">(</span><span class="token string">'td:nth-child(4)::text'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token punctuation">)</span>
        cashSellingRate <span class="token operator">=</span> info_list<span class="token punctuation">.</span>css<span class="token punctuation">(</span><span class="token string">'td:nth-child(5)::text'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token punctuation">)</span>
        theBankOfChinaReducedPrice <span class="token operator">=</span> info_list<span class="token punctuation">.</span>css<span class="token punctuation">(</span><span class="token string">'td:nth-child(6)::text'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token punctuation">)</span>
        theReleaseDate <span class="token operator">=</span> info_list<span class="token punctuation">.</span>css<span class="token punctuation">(</span><span class="token string">'td:nth-child(7)::text'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token punctuation">)</span>
        releaseTime <span class="token operator">=</span> info_list<span class="token punctuation">.</span>css<span class="token punctuation">(</span><span class="token string">'td:nth-child(8)::text'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
  <p>
   我们是要把这些数据保存到本地，也就是写入到csv。首先，就是写入到字典里面。
  </p>
  <pre class="line-numbers"><code class="language-python">dit <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token string">'货币名称'</span><span class="token punctuation">:</span> theNameOfTheCurrency<span class="token punctuation">,</span>
            <span class="token string">'现汇买入价'</span><span class="token punctuation">:</span> spotPrice<span class="token punctuation">,</span>
            <span class="token string">'现钞买入价'</span><span class="token punctuation">:</span> buyingRateForNotes<span class="token punctuation">,</span>
            <span class="token string">'现汇卖出价'</span><span class="token punctuation">:</span> theSpotSellingRate<span class="token punctuation">,</span>
            <span class="token string">'现钞卖出价'</span><span class="token punctuation">:</span> cashSellingRate<span class="token punctuation">,</span>
            <span class="token string">'中行折算价'</span><span class="token punctuation">:</span> theBankOfChinaReducedPrice<span class="token punctuation">,</span>
            <span class="token string">'发布日期'</span><span class="token punctuation">:</span> theReleaseDate<span class="token punctuation">,</span>
            <span class="token string">'发布时间'</span><span class="token punctuation">:</span> releaseTime<span class="token punctuation">,</span>
        <span class="token punctuation">}</span></code></pre>
  <p>
   到这里，我们的代码就基本上结束了，我们想要的数据也就实现了，我们还差最后一步，代码如下：
  </p>
  <pre class="line-numbers"><code class="language-python">csv_writer<span class="token punctuation">.</span>writerow<span class="token punctuation">(</span>dit<span class="token punctuation">)</span></code></pre>
  <h2>
   <a aria-hidden="true" class="anchor" href="#效果展示" id="user-content-效果展示">
    <span aria-hidden="true" class="octicon octicon-link">
    </span>
   </a>
   效果展示
  </h2>
  <p>
   <img alt="f191a1ab70b24137bac439955d8d84d0.png" src="https://img-blog.csdnimg.cn/f191a1ab70b24137bac439955d8d84d0.png" style="max-width: 100%;">
  </p>
  <p>
   我们可以看到，本地有一个csv文件，我们打开会惊奇的发现，我们居然得到了我们想要的数据。
  </p>
  <p>
   <img alt="cd98aba7d7fc454b9de7c77afd2d8809.png" src="https://img-blog.csdnimg.cn/cd98aba7d7fc454b9de7c77afd2d8809.png" style="max-width: 100%;">
  </p>
  <p>
   喜欢的话，可以给我点个赞。
  </p>
  <p>
   <img alt="6adf31c8c5dd4e6a83314f4805b30bc1.jpg" src="https://img-blog.csdnimg.cn/6adf31c8c5dd4e6a83314f4805b30bc1.jpg" style="max-width: 100%;">
  </p>
  <script src="prism.js">
  </script>
  <script>
   window.onscroll = function() {
    document.getElementById('catalogue').style.top = window.pageYOffset + 'px';
}
  </script>
 </body>
</html>