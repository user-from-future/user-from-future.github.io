<html>
 <head>
  <title>
   【Python实战】Python采集高校信息
  </title>
  <link data-noprefix="" href="prism.css" rel="stylesheet">
  <style>
   a{
    color: black;
    text-decoration: none;
}
a:hover{
    color: blue;
}
ul{
    list-style: none;
}
#catalogue {
    top: 10px;
    right: 10px;
    z-index: 1;
    padding: 5px 10px;
    position: absolute;
    border: 1px solid blue;
    background-color: white;
}
  </style>
 </head>
 <body>
  <h1>
   <a>
    【Python实战】Python采集高校信息
   </a>
  </h1>
  <ul id="catalogue">
   <li title="返回目录">
    <a href="/html">
     返回目录
    </a>
   </li>
   <li title="前言">
    <a href="#user-content-前言">
     前言
    </a>
   </li>
   <ul>
    <li title=" ">
     <a href="#user-content- ">
     </a>
    </li>
    <ul>
     <li title="环境使用">
      <a href="#user-content-环境使用">
       环境使用
      </a>
     </li>
     <li title="模块使用">
      <a href="#user-content-模块使用">
       模块使用
      </a>
     </li>
     <li title="模块介绍">
      <a href="#user-content-模块介绍">
       模块介绍
      </a>
     </li>
    </ul>
    <li title="代码实现">
     <a href="#user-content-代码实现">
      代码实现
     </a>
    </li>
    <li title="内容获取">
     <a href="#user-content-内容获取">
      内容获取
     </a>
    </li>
    <li title="全部代码">
     <a href="#user-content-全部代码">
      全部代码
     </a>
    </li>
   </ul>
   <li title="总结">
    <a href="#user-content-总结">
     总结
    </a>
   </li>
  </ul>
  <h1>
   <a aria-hidden="true" class="anchor" href="#前言" id="user-content-前言">
    <span aria-hidden="true" class="octicon octicon-link">
    </span>
   </a>
   前言
  </h1>
  <p>
   <img alt="" src="https://img-blog.csdnimg.cn/1b83b1d3fff541e6844ba7bfc4b8f724.gif" style="max-width: 100%;">
  </p>
  <blockquote>
   <p>
    大家好，我们今天来爬取某站的高校名单，把其高校名单，成员和内容数获取下来，不过，我们发现这个网站比我们平时多了一个验证，下面看看我是怎么解决的。
   </p>
  </blockquote>
  <p>
   <img alt="" src="https://img-blog.csdnimg.cn/img_convert/dd1231593f71ef2113352a571b87d17b.webp?x-oss-process=image/format,png" style="max-width: 100%;">
  </p>
  <h3>
   <a aria-hidden="true" class="anchor" href="#环境使用" id="user-content-环境使用">
    <span aria-hidden="true" class="octicon octicon-link">
    </span>
   </a>
   <strong>
    环境使用
   </strong>
  </h3>
  <ul>
   <li>
    python 3.9
   </li>
   <li>
    pycharm
   </li>
  </ul>
  <h3>
   <a aria-hidden="true" class="anchor" href="#模块使用" id="user-content-模块使用">
    <span aria-hidden="true" class="octicon octicon-link">
    </span>
   </a>
   <strong>
    模块使用
   </strong>
  </h3>
  <ul>
   <li>
    requests
   </li>
  </ul>
  <h3>
   <a aria-hidden="true" class="anchor" href="#模块介绍" id="user-content-模块介绍">
    <span aria-hidden="true" class="octicon octicon-link">
    </span>
   </a>
   <strong>
    模块介绍
   </strong>
  </h3>
  <blockquote>
   <ul>
    <li>
     <strong>
      requests
     </strong>
    </li>
   </ul>
   <p>
    requests是一个很实用的Python HTTP客户端库，爬虫和测试服务器响应数据时经常会用到，requests是Python语言的第三方的库，专门用于发送HTTP请求，使用起来比urllib简洁很多。
   </p>
   <ul>
    <li>
     <strong>
      parsel
     </strong>
    </li>
   </ul>
   <p>
    parsel是一个python的第三方库，相当于css选择器+xpath+re。
   </p>
   <p>
    parsel由scrapy团队开发，是将scrapy中的parsel独立抽取出来的，可以轻松解析html，xml内容，获取需要的数据。
   </p>
   <p>
    相比于BeautifulSoup，xpath，parsel效率更高，使用更简单。
   </p>
   <ul>
    <li>
     <strong>
      re
     </strong>
    </li>
   </ul>
   <p>
    re模块是python独有的匹配字符串的模块，该模块中提供的很多功能是基于正则表达式实现的，而正则表达式是对字符串进行模糊匹配，提取自己需要的字符串部分，他对所有的语言都通用。
   </p>
   <ul>
    <li>
     <strong>
      os
     </strong>
    </li>
   </ul>
   <p>
    os 就是 &ldquo;operating system&rdquo; 的缩写，顾名思义，
    <a href="https://so.csdn.net/so/search?q=os%E6%A8%A1%E5%9D%97&amp;spm=1001.2101.3001.7020" rel="nofollow" title="os模块">
     os模块
    </a>
    提供的就是各种 Python 程序与操作系统进行交互的接口。通过使用 os 模块，一方面可以方便地与操作系统进行交互，另一方面也可以极大增强代码的可移植性。
   </p>
   <ul>
    <li>
     <strong>
      csv
     </strong>
    </li>
   </ul>
   <p>
    它是一种文件格式，一般也被叫做逗号分隔值文件，可以使用 Excel 软件或者文本文档打开 。其中数据字段用半角逗号间隔（也可以使用其它字符），使用 Excel 打开时，逗号会被转换为分隔符。csv 文件是以纯文本形式存储了表格数据，并且在兼容各个操作系统。
   </p>
  </blockquote>
  <p>
   <strong>
    模块安装问题:
   </strong>
  </p>
  <ul>
   <li>
    如果安装python第三方模块:
   </li>
  </ul>
  <blockquote>
   <p>
    win + R 输入 cmd 点击确定, 输入安装命令 pip install 模块名 (pip install requests) 回车
   </p>
   <p>
    在pycharm中点击Terminal(终端) 输入安装命令
   </p>
  </blockquote>
  <ul>
   <li>
    安装失败原因:
   </li>
  </ul>
  <blockquote>
   <ul>
    <li>
     失败一: pip 不是内部命令
    </li>
   </ul>
   <p>
    解决方法: 设置环境变量
   </p>
   <ul>
    <li>
     失败二: 出现大量报红 (read time out)
    </li>
   </ul>
   <p>
    解决方法: 因为是网络链接超时, 需要切换镜像源
   </p>
   <pre class="line-numbers"><code class="language-python">清华：https<span class="token punctuation">:</span><span class="token operator">//</span>pypi<span class="token punctuation">.</span>tuna<span class="token punctuation">.</span>tsinghua<span class="token punctuation">.</span>edu<span class="token punctuation">.</span>cn<span class="token operator">/</span>simple
    阿里云：https<span class="token punctuation">:</span><span class="token operator">//</span>mirrors<span class="token punctuation">.</span>aliyun<span class="token punctuation">.</span>com<span class="token operator">/</span>pypi<span class="token operator">/</span>simple<span class="token operator">/</span>
    中国科技大学 https<span class="token punctuation">:</span><span class="token operator">//</span>pypi<span class="token punctuation">.</span>mirrors<span class="token punctuation">.</span>ustc<span class="token punctuation">.</span>edu<span class="token punctuation">.</span>cn<span class="token operator">/</span>simple<span class="token operator">/</span>
    华中理工大学：https<span class="token punctuation">:</span><span class="token operator">//</span>pypi<span class="token punctuation">.</span>hustunique<span class="token punctuation">.</span>com<span class="token operator">/</span>
    山东理工大学：https<span class="token punctuation">:</span><span class="token operator">//</span>pypi<span class="token punctuation">.</span>sdutlinux<span class="token punctuation">.</span>org<span class="token operator">/</span>
    豆瓣：https<span class="token punctuation">:</span><span class="token operator">//</span>pypi<span class="token punctuation">.</span>douban<span class="token punctuation">.</span>com<span class="token operator">/</span>simple<span class="token operator">/</span>
    例如：pip3 install <span class="token operator">-</span>i https<span class="token punctuation">:</span><span class="token operator">//</span>pypi<span class="token punctuation">.</span>doubanio<span class="token punctuation">.</span>com<span class="token operator">/</span>simple<span class="token operator">/</span> 模块名</code></pre>
   <ul>
    <li>
     失败三: cmd里面显示已经安装过了, 或者安装成功了, 但是在pycharm里面还是无法导入
    </li>
   </ul>
   <p>
    解决方法: 可能安装了多个python版本 (anaconda 或者 python 安装一个即可) 卸载一个就好，或者你pycharm里面python解释器没有设置好。
   </p>
  </blockquote>
  <h2>
   <a aria-hidden="true" class="anchor" href="#代码实现" id="user-content-代码实现">
    <span aria-hidden="true" class="octicon octicon-link">
    </span>
   </a>
   代码实现
  </h2>
  <p>
   话不多说，我们和平时一样，发送我们的请求，按照平时，我们看看代码怎么写。
  </p>
  <pre class="line-numbers"><code class="language-python">url <span class="token operator">=</span> <span class="token string">'https://bizapi.csdn.net/community-cloud/v1/homepage/community/by/tag?deviceType=PC&amp;tagId=37'</span>
headers <span class="token operator">=</span> <span class="token punctuation">{</span>  
<span class="token string">'User-Agent'</span><span class="token punctuation">:</span> <span class="token string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/108.0.0.0 Safari/537.36'</span><span class="token punctuation">}</span>  
  
response <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token operator">=</span>url<span class="token punctuation">,</span>headers<span class="token operator">=</span>headers<span class="token punctuation">)</span></code></pre>
  <p>
   我们在这里使用
   <code>
    requests
   </code>
   库发送 GET 请求，并将 URL 和请求头作为参数传递给
   <code>
    get
   </code>
   方法。请求的 URL 是
   <code>
    https://bizapi.csdn.net/community-cloud/v1/homepage/community/by/tag?deviceType=PC&amp;tagId=37
   </code>
   ，表示查询社区根据标签分类的数据。请求头包含了
   <code>
    User-Agent
   </code>
   和
   <code>
    Accept
   </code>
   字段，分别表示客户端的 User-Agent 和 Accept 协议类型。
  </p>
  <p>
   不过我们会发现，我们得不到数据，就说明我们被反爬了，我尝试了很多次，我们发现它做了一个验证。
  </p>
  <pre class="line-numbers"><code class="language-python">headers <span class="token operator">=</span> <span class="token punctuation">{</span>  
<span class="token string">'accept'</span><span class="token punctuation">:</span> <span class="token string">'application/json, text/plain, */*'</span><span class="token punctuation">,</span>  
<span class="token string">'origin'</span><span class="token punctuation">:</span> <span class="token string">'https://bbs.csdn.net'</span><span class="token punctuation">,</span>  
<span class="token string">'referer'</span><span class="token punctuation">:</span> <span class="token string">'https://bbs.csdn.net/college?utm_source=csdn_bbs_toolbar&amp;spm=1035.2022.3001.8850&amp;category=37'</span><span class="token punctuation">,</span>  
<span class="token string">'user-agent'</span><span class="token punctuation">:</span> <span class="token string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/111.0.0.0 Safari/537.36'</span><span class="token punctuation">,</span>  
<span class="token string">'x-ca-key'</span><span class="token punctuation">:</span> <span class="token string">'203899271'</span><span class="token punctuation">,</span>  
<span class="token string">'x-ca-nonce'</span><span class="token punctuation">:</span> <span class="token string">'13b10c23-6a9b-423e-92a7-b114bc2c7f48'</span><span class="token punctuation">,</span>  
<span class="token string">'x-ca-signature'</span><span class="token punctuation">:</span> <span class="token string">'Hhnf/RUARDM2jddNAkl2tJ6hpXfweWbY1U4/yh6FCZM='</span><span class="token punctuation">,</span>  
<span class="token string">'x-ca-signature-headers'</span><span class="token punctuation">:</span> <span class="token string">'x-ca-key,x-ca-nonce'</span><span class="token punctuation">,</span>  
<span class="token punctuation">}</span></code></pre>
  <p>
   我们这里科普一下，x-ca-signature 是对请求内容的签名，用于验证请求的完整性和可信性。 签名通常是通过使用私钥和一种哈希算法（如 SHA256）对请求内容进行计算得到的。 如果请求头中出现这三个参数，放心，是为了反爬用的，当然也可以用于限制请求频率，防止恶意攻击。
  </p>
  <p>
   在解决该反爬问题时，第一步就是要找到他们的加密点。寻找 x-ca-key、x-ca-nonce、x-ca-signature 加密位置这一步主要看你对开发者工具的使用熟练程度了，寻找任意一个携带该请求头参数的请求，然后添加相应断点。通过请求地址中的部分关键字，即可添加 XHR 断点。再次刷新页面，可进入断点中，一般会停留在send()函数位置。 下面的步骤就是比较枯燥的了，需要一点点的解密，例如在本函数头部找到headers，发现其参数 x-ca-key、x-ca-nonce、x-ca-signature 已经被赋值。
  </p>
  <p>
   这里我们没有做多页爬虫，就没有去解密了，感兴趣的朋友自己去尝试。
  </p>
  <h2>
   <a aria-hidden="true" class="anchor" href="#内容获取" id="user-content-内容获取">
    <span aria-hidden="true" class="octicon octicon-link">
    </span>
   </a>
   内容获取
  </h2>
  <p>
   我们拿到了数据，接下来就可以提取内容了，我们看看代码怎么写，这里就很简单了。
  </p>
  <pre class="line-numbers"><code class="language-python">data <span class="token operator">=</span>responses<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span>  
<span class="token keyword">for</span> <span class="token builtin">list</span> <span class="token keyword">in</span> data<span class="token punctuation">:</span>   
    tagName <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">[</span><span class="token string">'tagName'</span><span class="token punctuation">]</span>  
    list_url<span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">[</span><span class="token string">'url'</span><span class="token punctuation">]</span>  
    res <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>list_url<span class="token punctuation">)</span>  
    num <span class="token operator">=</span> re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span><span class="token string">'&lt;div title="(\d+)"'</span><span class="token punctuation">,</span>res<span class="token punctuation">.</span>text<span class="token punctuation">)</span>  
    <span class="token keyword">print</span><span class="token punctuation">(</span>tagName<span class="token punctuation">,</span>list_url<span class="token punctuation">,</span>num<span class="token punctuation">)</span></code></pre>
  <p>
   我们这里使用
   <code>
    responses.json()['data']
   </code>
   读取 API 响应 JSON 数据，并在一个数组中提取数据。然后，它使用一个 for 循环遍历数组中的每个元素，提取
   <code>
    tagName
   </code>
   和
   <code>
    url
   </code>
   两个字段，并使用
   <code>
    requests.get()
   </code>
   发送 GET 请求获取数据。最后，它使用正则表达式从响应文本中提取
   <code>
    num
   </code>
   数据，并将其打印到控制台上。
  </p>
  <h2>
   <a aria-hidden="true" class="anchor" href="#全部代码" id="user-content-全部代码">
    <span aria-hidden="true" class="octicon octicon-link">
    </span>
   </a>
   全部代码
  </h2>
  <pre class="line-numbers"><code class="language-python"><span class="token keyword">import</span> re

<span class="token keyword">import</span> requests

url <span class="token operator">=</span> <span class="token string">'https://bizapi.csdn.net/community-cloud/v1/homepage/community/by/tag?deviceType=PC&amp;tagId=37'</span>
<span class="token comment"># url = https://bbs.csdn.net/college?category=37 # 主页</span>

headers <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string">'accept'</span><span class="token punctuation">:</span> <span class="token string">'application/json, text/plain, */*'</span><span class="token punctuation">,</span>
    <span class="token string">'origin'</span><span class="token punctuation">:</span> <span class="token string">'https://bbs.csdn.net'</span><span class="token punctuation">,</span>
    <span class="token string">'referer'</span><span class="token punctuation">:</span> <span class="token string">'https://bbs.csdn.net/college?utm_source=csdn_bbs_toolbar&amp;spm=1035.2022.3001.8850&amp;category=37'</span><span class="token punctuation">,</span>
    <span class="token string">'user-agent'</span><span class="token punctuation">:</span> <span class="token string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/111.0.0.0 Safari/537.36'</span><span class="token punctuation">,</span>
    <span class="token string">'x-ca-key'</span><span class="token punctuation">:</span> <span class="token string">'203899271'</span><span class="token punctuation">,</span>
    <span class="token string">'x-ca-nonce'</span><span class="token punctuation">:</span> <span class="token string">'13b10c23-6a9b-423e-92a7-b114bc2c7f48'</span><span class="token punctuation">,</span>
    <span class="token string">'x-ca-signature'</span><span class="token punctuation">:</span> <span class="token string">'Hhnf/RUARDM2jddNAkl2tJ6hpXfweWbY1U4/yh6FCZM='</span><span class="token punctuation">,</span>
    <span class="token string">'x-ca-signature-headers'</span><span class="token punctuation">:</span> <span class="token string">'x-ca-key,x-ca-nonce'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
responses <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">,</span>headers<span class="token operator">=</span>headers<span class="token punctuation">)</span>
data <span class="token operator">=</span>responses<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span>
<span class="token comment"># print(data)</span>
<span class="token keyword">for</span> <span class="token builtin">list</span> <span class="token keyword">in</span> data<span class="token punctuation">:</span>
    <span class="token comment"># print(list)</span>
    tagName <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">[</span><span class="token string">'tagName'</span><span class="token punctuation">]</span>
    list_url<span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">[</span><span class="token string">'url'</span><span class="token punctuation">]</span>
    res <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>list_url<span class="token punctuation">)</span>
    <span class="token comment"># print(res.text)</span>
    num <span class="token operator">=</span> re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span><span class="token string">'&lt;div title="(\d+)"'</span><span class="token punctuation">,</span>res<span class="token punctuation">.</span>text<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>tagName<span class="token punctuation">,</span>list_url<span class="token punctuation">,</span>num<span class="token punctuation">)</span></code></pre>
  <h1>
   <a aria-hidden="true" class="anchor" href="#总结" id="user-content-总结">
    <span aria-hidden="true" class="octicon octicon-link">
    </span>
   </a>
   总结
  </h1>
  <p>
   我们这样就获取到了内容，本文仅供学习。
  </p>
  <p>
   <img alt="" src="https://img-blog.csdnimg.cn/img_convert/9e7d5f1f72aca0f21252de78cc872146.webp?x-oss-process=image/format,png" style="max-width: 100%;">
  </p>
  <p>
   <img alt="6adf31c8c5dd4e6a83314f4805b30bc1.jpg" src="https://img-blog.csdnimg.cn/6adf31c8c5dd4e6a83314f4805b30bc1.jpg" style="max-width: 100%;">
  </p>
  <script src="prism.js">
  </script>
  <script>
   window.onscroll = function() {
    document.getElementById('catalogue').style.top = window.pageYOffset + 'px';
}
  </script>
 </body>
</html>