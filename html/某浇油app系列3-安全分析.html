<html>
 <head>
  <title>
   某浇油app系列3-安全分析
  </title>
  <link data-noprefix="" href="prism.css" rel="stylesheet">
  <style>
   a{
    color: black;
    text-decoration: none;
}
a:hover{
    color: blue;
}
ul{
    list-style: none;
}
#catalogue {
    top: 10px;
    right: 10px;
    padding: 5px 10px;
    position: absolute;
    border: 1px solid blue;
    background-color: white;
}
  </style>
 </head>
 <body>
  <h1>
   <a>
    某浇油app系列3-安全分析
   </a>
  </h1>
  <ul id="catalogue">
   <li title="返回目录">
    <a href="/html">
     返回目录
    </a>
   </li>
   <li title="声明">
    <a href="#user-content-声明">
     声明
    </a>
   </li>
   <ul>
    <li title="  ">
     <a href="#user-content-  ">
     </a>
    </li>
   </ul>
   <li title="前言">
    <a href="#user-content-前言">
     前言
    </a>
   </li>
   <li title="分析">
    <a href="#user-content-分析">
     分析
    </a>
   </li>
   <ul>
    <li title="1.加密逻辑定位">
     <a href="#user-content-1加密逻辑定位">
      1.加密逻辑定位
     </a>
    </li>
    <li title="2.native层分析">
     <a href="#user-content-2native层分析">
      2.native层分析
     </a>
    </li>
   </ul>
   <li title="验证">
    <a href="#user-content-验证">
     验证
    </a>
   </li>
   <li title="结语">
    <a href="#user-content-结语">
     结语
    </a>
   </li>
  </ul>
  <h2>
   <a aria-hidden="true" class="anchor" href="#声明" id="user-content-声明">
    <span aria-hidden="true" class="octicon octicon-link">
    </span>
   </a>
   声明
  </h2>
  <h3>
  </h3>
  <p>
   以下只是搬运下我公众号的东西。很早就发过了。原帖地址：
  </p>
  <p>
   <a href="https://mp.weixin.qq.com/s/WCyNeVQItC2YXAoHEEdm7w" rel="nofollow" title="某浇油app系列3-安全分析">
    某浇油app系列3-安全分析
   </a>
  </p>
  <p>
   已经发公众号的为什么还发csdn
   <br>
   有的圈内朋友，不经过我的允许，删减摘录我公众号的内容，这里就不提谁了，心里清楚，还能获得一些关注和流量。很无语，所以我还不如自己也发发。【猛男落泪】
  </p>
  <h2>
   <a aria-hidden="true" class="anchor" href="#前言" id="user-content-前言">
    <span aria-hidden="true" class="octicon octicon-link">
    </span>
   </a>
   前言
  </h2>
  <p>
   继续交友系列
  </p>
  <p>
   是下面这个图片，评论区里的广告，不注意看还以为是用户发的
  </p>
  <p>
   <img alt="" src="https://img-blog.csdnimg.cn/img_convert/1afd1da868b54000f13bedce3dd88bc0.png" style="max-width: 100%;">
  </p>
  <p>
   同样的，看首页的推荐接口：
  </p>
  <p>
   <img alt="" src="https://img-blog.csdnimg.cn/img_convert/99952c6987dcc3566c4a00052b7571a5.png" style="max-width: 100%;">
  </p>
  <h2>
   <a aria-hidden="true" class="anchor" href="#分析" id="user-content-分析">
    <span aria-hidden="true" class="octicon octicon-link">
    </span>
   </a>
   分析
  </h2>
  <p>
   copy到postman里，能直接用，去掉一些参数也是
  </p>
  <p>
   <img alt="" src="https://img-blog.csdnimg.cn/img_convert/345e8958ed12b9b6c1b25a78d87009cb.png" style="max-width: 100%;">
  </p>
  <p>
   再试试header里的参数：就发现，这两个参数必不可少了
  </p>
  <p>
   看到token，首先想到是不是登录后返回的
  </p>
  <p>
   <img alt="" src="https://img-blog.csdnimg.cn/img_convert/dadf03f31d41534a0cff94e51643331f.png" style="max-width: 100%;">
  </p>
  <p>
   在app这边，账号退出再重新登录，抓包继续看：
  </p>
  <p>
   卧槽了，这个token就是账号登录后返回的，
  </p>
  <p>
   <img alt="" src="https://img-blog.csdnimg.cn/img_convert/9c5d69eaefdaf190ff8195d7ed12ca17.png" style="max-width: 100%;">
  </p>
  <p>
   毫无压力啊卧槽
  </p>
  <p>
   但是仔细看，登录有两个加密参数，password和pwd
  </p>
  <p>
   <img alt="" src="https://img-blog.csdnimg.cn/img_convert/79996e10506f040a7d9cc9df62e20062.png" style="max-width: 100%;">
  </p>
  <p>
   好的，这就来到了本篇文章的正题
  </p>
  <h3>
   <a aria-hidden="true" class="anchor" href="#1加密逻辑定位" id="user-content-1加密逻辑定位">
    <span aria-hidden="true" class="octicon octicon-link">
    </span>
   </a>
   1.加密逻辑定位
  </h3>
  <p>
   1.1.&nbsp;frida动态调试
  </p>
  <p>
   首先脱个壳
  </p>
  <p>
   先搜"password"，运气很好，一下就找到这里：
  </p>
  <p>
   <img alt="" src="https://img-blog.csdnimg.cn/img_convert/6abeeeaf27ad6946d49709e3a713840d.png" style="max-width: 100%;">
  </p>
  <p>
   然后objection走一下呢，卧槽， 有对抗
  </p>
  <p>
   <img alt="" src="https://img-blog.csdnimg.cn/img_convert/fd70f40964b8eb81ae69831ac8c28ec9.png" style="max-width: 100%;">
  </p>
  <p>
   用antifrida脚本看看，ok，可以
  </p>
  <p>
   <img alt="" src="https://img-blog.csdnimg.cn/img_convert/aaed51b59f14060f87b2ee85c97f2abc.png" style="max-width: 100%;">
  </p>
  <p>
   加上自己的hook逻辑
  </p>
  <p>
   <img alt="" src="https://img-blog.csdnimg.cn/img_convert/f625ab7b8dded7cb908e60a65aea485e.png" style="max-width: 100%;">
  </p>
  <p>
   但是感觉还是没走到，貌似，不在一个classloader?
  </p>
  <p>
   <img alt="" src="https://img-blog.csdnimg.cn/img_convert/5b88e505d9cbdf4358e76cbaedbdc4c7.png" style="max-width: 100%;">
  </p>
  <p>
   那就切换classloader，涉及到的代码网上一大把，这里就不说了。
  </p>
  <p>
   根据我的操作，结果还是不行，那好吧，继续上xposed看看：
  </p>
  <p>
   1.2.&nbsp;xpoed 自写hook插件分析
  </p>
  <p>
   相关的xp配置这里就省略了，上面已经说过了。
  </p>
  <p>
   <img alt="" src="https://img-blog.csdnimg.cn/img_convert/73a1664c64f82e803a53756ce9645ac1.png" style="max-width: 100%;">
  </p>
  <p>
   然后重新走登录逻辑，看看打印日志：
  </p>
  <p>
   <img alt="" src="https://img-blog.csdnimg.cn/img_convert/e292bd72786b3e2732594a9272b67c32.png" style="max-width: 100%;">
  </p>
  <p>
   这个加密结果基本能跟抓包的对应上
  </p>
  <p>
   <img alt="" src="https://img-blog.csdnimg.cn/img_convert/5b06f1ef626f48b750ba28433ea363be.png" style="max-width: 100%;">
  </p>
  <p>
   那加密逻辑就是这里了。很奇怪，frida就是不行，xp就是可以，不管了，东西太多了，不用一个一个都去纠结
  </p>
  <p>
   1.3.&nbsp; 算法助手插件辅助分析
  </p>
  <p>
   这里加个餐，用另一个方法定位这个加密参数逻辑
  </p>
  <p>
   用军哥大佬开发的【算法助手】工具，这个也是xp的一个插件，进到xp里勾选上目标app，然后点进来，按照以下步骤操作
  </p>
  <p>
   <img alt="" src="https://img-blog.csdnimg.cn/img_convert/33e9ce01b8b3f94c23ac5425fc27f754.png" style="max-width: 100%;">
  </p>
  <p>
   第三步点完之后，会自动启动app，手机这边正常重新登录操作，
  </p>
  <p>
   点击登陆后，回到算法助手，返回到日志tab下，点进你的目标app
  </p>
  <p>
   <img alt="" src="https://img-blog.csdnimg.cn/img_convert/c81ea01240fe84d8e40e4127698fb1d9.png" style="max-width: 100%;">
  </p>
  <p>
   然后就会有很多这种日志：
  </p>
  <p>
   <img alt="" src="https://img-blog.csdnimg.cn/img_convert/efac85e7dc186e11fca7db0a5900535f.png" style="max-width: 100%;">
  </p>
  <p>
   直接点搜索按钮：
  </p>
  <p>
   <img alt="" src="https://img-blog.csdnimg.cn/img_convert/704c28058b662e258f536d2cda3fc27d.png" style="max-width: 100%;">
  </p>
  <p>
   到抓包工具里，复制加密字段，然后拿来搜
  </p>
  <p>
   <img alt="" src="https://img-blog.csdnimg.cn/img_convert/c87a0fefc6ea63ddd2341f58674a4b8c.png" style="max-width: 100%;">
  </p>
  <p>
   <img alt="" src="https://img-blog.csdnimg.cn/img_convert/da150ad0a1b83ee21d39884baeebee86.png" style="max-width: 100%;">
  </p>
  <p>
   点进去，对照着看，基本能确定，是同一个
  </p>
  <p>
   <img alt="" src="https://img-blog.csdnimg.cn/img_convert/d8f80399f091a33b2fe7d74399b3dd63.png" style="max-width: 100%;">
  </p>
  <p>
   然后往下滑，有一个调用栈，这不就出来了吗，直接就找到位置了，发现这个位置基本跟刚才hook写的地方一致
  </p>
  <p>
   <img alt="" src="https://img-blog.csdnimg.cn/img_convert/ba7d3f136cfe701d2bb6a0223a1a20da.png" style="max-width: 100%;">
  </p>
  <p>
   这个方法适用于无法直接搜到加密参数的时候，或者你毫无头绪的时候，可以辅助查看
  </p>
  <p>
   好了回到正题，跟着刚才的定位，再往里跟逻辑，实际的加密其实就是这个：CustAmuIExt
  </p>
  <p>
   <img alt="" src="https://img-blog.csdnimg.cn/img_convert/40f86907c2fa9a3082092e1b832474be.png" style="max-width: 100%;">
  </p>
  <p>
   仔细看就知道就是native层的加密了
  </p>
  <h3>
   <a aria-hidden="true" class="anchor" href="#2native层分析" id="user-content-2native层分析">
    <span aria-hidden="true" class="octicon octicon-link">
    </span>
   </a>
   2.native层分析
  </h3>
  <p>
   掏出ida，拖进这个ve04:
  </p>
  <p>
   <img alt="" src="https://img-blog.csdnimg.cn/img_convert/b904bba2a64b1a67ad1af515aad252f7.png" style="max-width: 100%;">
  </p>
  <p>
   卧槽，原来就是个tea加密
  </p>
  <p>
   <img alt="" src="https://img-blog.csdnimg.cn/img_convert/1bfee348e326bbb13f58ac9c0c432c77.png" style="max-width: 100%;">
  </p>
  <p>
   这里唯一要注意的就是，哪个key，标准的tea加密的key是数字，而这里传进去的key是 【liaoxxxlib_xxx】
  </p>
  <p>
   看下这个tea加密：
  </p>
  <p>
   <img alt="" src="https://img-blog.csdnimg.cn/img_convert/903a3f94e4f3d6c2b0118705d5ed8a7c.png" style="max-width: 100%;">
  </p>
  <p>
   <img alt="" src="https://img-blog.csdnimg.cn/img_convert/1ebc1d9ceb5fd3d30ee4ef97a3f20096.png" style="max-width: 100%;">
  </p>
  <p>
   就这么几行，量它没有魔改，看着就搞个所以，注意下key就行，整个加密就这样，感觉不难
  </p>
  <h2>
   <a aria-hidden="true" class="anchor" href="#验证" id="user-content-验证">
    <span aria-hidden="true" class="octicon octicon-link">
    </span>
   </a>
   验证
  </h2>
  <p>
   具体我就不测试了。可以自行分析
  </p>
  <p>
   分析完了后，看了下消息，挺好，才几条，感觉这个app里的人要真一点
  </p>
  <p>
   <img alt="" src="https://img-blog.csdnimg.cn/img_convert/cd49f39ef52613a9c0aaed42d647fb76.png" style="max-width: 100%;">
  </p>
  <p>
   <img alt="" src="https://img-blog.csdnimg.cn/img_convert/01dc0463b5c6329641b072e772ddfd7a.png" style="max-width: 100%;">
  </p>
  <h2>
   <a aria-hidden="true" class="anchor" href="#结语" id="user-content-结语">
    <span aria-hidden="true" class="octicon octicon-link">
    </span>
   </a>
   结语
  </h2>
  <p>
   感觉搞了这几个浇油类的app之后，大多都很简单，有点不想继续更这个系列了。练手可以，但是如果后续都是这种程度的话，就有点不想继续写了，相信各位朋友看多了也没啥意思了，不过还是看受众效果或者后面有没有代表性的吧。over
  </p>
  <p>
   哥哥们，关注下我好不好
  </p>
  <p>
   <img alt="" src="https://img-blog.csdnimg.cn/img_convert/d16e57221a60d76db4f4777b74619cd4.png" style="max-width: 100%;">
  </p>
  <p>
   工作避坑&amp;内推（仅成都）、技术交流、商务合作、技术交流群
  </p>
  <p>
   扫码或者搜ID：
   <strong>
    geekbyte
   </strong>
  </p>
  <script src="prism.js">
  </script>
  <script>
   window.onscroll = function() {
    document.getElementById('catalogue').style.top = window.pageYOffset + 'px';
}
  </script>
 </body>
</html>